import{c as b,r,j as e,L as y}from"./index-BSnqS6Qo.js";const N=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],k=b("play",N);const w=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],L=b("sparkles",w),E="_container_1gmvt_1",Q="_header_1gmvt_10",C="_inputSection_1gmvt_23",H="_textarea_1gmvt_29",$="_btn_1gmvt_46",z="_spin_1gmvt_72",O="_sqlSection_1gmvt_80",M="_sqlHeader_1gmvt_87",T="_sqlCode_1gmvt_100",G="_error_1gmvt_110",W="_resultsSection_1gmvt_119",I="_resultsHeader_1gmvt_126",J="_tableWrap_1gmvt_134",P="_table_1gmvt_134",t={container:E,header:Q,inputSection:C,textarea:H,btn:$,spin:z,sqlSection:O,sqlHeader:M,sqlCode:T,error:G,resultsSection:W,resultsHeader:I,tableWrap:J,table:P};function F({apiUrl:d}){const[l,v]=r.useState(""),[c,u]=r.useState(""),[n,o]=r.useState(null),[h,m]=r.useState(!1),[_,x]=r.useState(!1),[g,i]=r.useState(""),p={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},q=async()=>{if(l.trim()){m(!0),i(""),u(""),o(null);try{const s=await fetch(`${d}/klaus/imi/sql/generate`,{method:"POST",headers:p,body:JSON.stringify({question:l.trim()})});if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const a=await s.json();u(a.sql||a.query||JSON.stringify(a,null,2))}catch(s){i(s instanceof Error?s.message:"Failed to generate SQL")}finally{m(!1)}}},f=async()=>{if(c.trim()){x(!0),i(""),o(null);try{const s=await fetch(`${d}/klaus/imi/sql/execute`,{method:"POST",headers:p,body:JSON.stringify({sql:c.trim()})});if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const a=await s.json();o(a.results||a.rows||a.data||[])}catch(s){i(s instanceof Error?s.message:"Failed to execute SQL")}finally{x(!1)}}},S=n&&n.length>0?Object.keys(n[0]):[];return e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsx("h1",{children:"SQL Lab"}),e.jsx("p",{children:"Natural language to SQL â€” query 55+ years of IMI data"})]}),e.jsxs("div",{className:t.inputSection,children:[e.jsx("textarea",{className:t.textarea,placeholder:"Ask a question in plain English, e.g. 'Show top 10 brands by awareness in Germany 2023'",value:l,onChange:s=>v(s.target.value),rows:3}),e.jsxs("button",{className:t.btn,onClick:q,disabled:h||!l.trim(),children:[h?e.jsx(y,{size:16,className:t.spin}):e.jsx(L,{size:16}),"Generate SQL"]})]}),c&&e.jsxs("div",{className:t.sqlSection,children:[e.jsxs("div",{className:t.sqlHeader,children:[e.jsx("span",{children:"Generated SQL"}),e.jsxs("button",{className:t.btn,onClick:f,disabled:_,children:[_?e.jsx(y,{size:16,className:t.spin}):e.jsx(k,{size:16}),"Execute"]})]}),e.jsx("pre",{className:t.sqlCode,children:c})]}),g&&e.jsx("div",{className:t.error,children:g}),n&&e.jsxs("div",{className:t.resultsSection,children:[e.jsxs("div",{className:t.resultsHeader,children:[n.length," row",n.length!==1?"s":""," returned"]}),e.jsx("div",{className:t.tableWrap,children:e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsx("tr",{children:S.map(s=>e.jsx("th",{children:s},s))})}),e.jsx("tbody",{children:n.map((s,a)=>e.jsx("tr",{children:S.map(j=>e.jsx("td",{children:String(s[j]??"")},j))},a))})]})})]})]})}export{F as default};
