import{c as u,r as t,j as s,b as v,a as H,H as V,L as f}from"./index-yZ_RLkP0.js";import{S as D}from"./search-BJeNHSDh.js";import{R as $}from"./refresh-cw-CLIdgFi0.js";const M=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],P=u("chevron-down",M);const E=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],A=u("chevron-right",E);const B=[["path",{d:"M12 22v-5",key:"1ega77"}],["path",{d:"M15 8V2",key:"18g5xt"}],["path",{d:"M17 8a1 1 0 0 1 1 1v4a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1z",key:"1xoxul"}],["path",{d:"M9 8V2",key:"14iosj"}]],g=u("plug",B),G="_container_1kplp_1",W="_header_1kplp_7",q="_stats_1kplp_23",F="_statCard_1kplp_30",J="_statIcon_1kplp_42",K="_statValue_1kplp_52",O="_statLabel_1kplp_59",Q="_controls_1kplp_67",X="_searchWrap_1kplp_75",Y="_searchIcon_1kplp_80",Z="_search_1kplp_75",U="_connectionsSection_1kplp_105",ss="_sectionTitle_1kplp_109",es="_connectionsList_1kplp_118",as="_connectionCard_1kplp_124",ns="_connectionIcon_1kplp_135",cs="_connectionName_1kplp_140",ts="_connectionType_1kplp_145",os="_connectionStatus_1kplp_154",ls="_statusActive_1kplp_159",is="_table_1kplp_164",rs="_tableHeader_1kplp_171",ds="_row_1kplp_183",ps="_expandIcon_1kplp_197",hs="_fileCell_1kplp_203",_s="_fileIcon_1kplp_209",ms="_fileName_1kplp_214",us="_records_1kplp_223",xs="_colCount_1kplp_230",js="_sourceType_1kplp_236",Ns="_catTag_1kplp_240",ks="_schemaPanel_1kplp_250",vs="_schemaLoading_1kplp_256",fs="_schemaGrid_1kplp_264",gs="_schemaHeader_1kplp_270",Cs="_schemaRow_1kplp_281",ws="_colName_1kplp_288",Ls="_colType_1kplp_294",Ss="_noResults_1kplp_300",ys="_footer_1kplp_308",Ts="_exportBtn_1kplp_317",Is="_spin_1kplp_336",e={container:G,header:W,stats:q,statCard:F,statIcon:J,statValue:K,statLabel:O,controls:Q,searchWrap:X,searchIcon:Y,search:Z,connectionsSection:U,sectionTitle:ss,connectionsList:es,connectionCard:as,connectionIcon:ns,connectionName:cs,connectionType:ts,connectionStatus:os,statusActive:ls,table:is,tableHeader:rs,row:ds,expandIcon:ps,fileCell:hs,fileIcon:_s,fileName:ms,records:us,colCount:xs,sourceType:js,catTag:Ns,schemaPanel:ks,schemaLoading:vs,schemaGrid:fs,schemaHeader:gs,schemaRow:Cs,colName:ws,colType:Ls,noResults:Ss,footer:ys,exportBtn:Ts,spin:Is};function Hs({apiUrl:i}){const[o,C]=t.useState([]),[r,w]=t.useState([]),[d,L]=t.useState(""),[l,x]=t.useState(!0),[p,j]=t.useState(null),[h,S]=t.useState({}),[y,N]=t.useState(null),_={"ngrok-skip-browser-warning":"true"},k=async()=>{x(!0);const[a,n]=await Promise.allSettled([fetch(`${i}/klaus/imi/warehouse/datasets`,{headers:_}),fetch(`${i}/klaus/imi/connections/list`,{headers:_})]);if(a.status==="fulfilled"&&a.value.ok){const c=await a.value.json();C(c.datasets||c||[])}if(n.status==="fulfilled"&&n.value.ok){const c=await n.value.json();w(c.connections||c||[])}x(!1)};t.useEffect(()=>{k()},[]);const T=async a=>{if(!h[a]){N(a);try{const n=await fetch(`${i}/klaus/imi/warehouse/schema/${a}`,{headers:_});if(n.ok){const c=await n.json();S(z=>({...z,[a]:c.columns||c.schema||[]}))}}catch{}N(null)}},I=a=>{p===a?j(null):(j(a),T(a))},m=o.filter(a=>!d||a.name.toLowerCase().includes(d.toLowerCase())),b=o.reduce((a,n)=>a+(n.row_count||0),0),R=o.reduce((a,n)=>a+(n.column_count||0),0);return s.jsxs("div",{className:e.container,children:[s.jsx("div",{className:e.header,children:s.jsxs("div",{children:[s.jsx("h1",{children:"Data Sources"}),s.jsx("p",{children:l?"Loading...":`${o.length} datasets in warehouse`})]})}),!l&&s.jsxs("div",{className:e.stats,children:[s.jsxs("div",{className:e.statCard,children:[s.jsx(v,{size:16,className:e.statIcon}),s.jsxs("div",{children:[s.jsx("span",{className:e.statValue,children:o.length}),s.jsx("span",{className:e.statLabel,children:"Datasets"})]})]}),s.jsxs("div",{className:e.statCard,children:[s.jsx(H,{size:16,className:e.statIcon}),s.jsxs("div",{children:[s.jsx("span",{className:e.statValue,children:b.toLocaleString()}),s.jsx("span",{className:e.statLabel,children:"Total Rows"})]})]}),s.jsxs("div",{className:e.statCard,children:[s.jsx(V,{size:16,className:e.statIcon}),s.jsxs("div",{children:[s.jsx("span",{className:e.statValue,children:R.toLocaleString()}),s.jsx("span",{className:e.statLabel,children:"Total Columns"})]})]}),s.jsxs("div",{className:e.statCard,children:[s.jsx(g,{size:16,className:e.statIcon}),s.jsxs("div",{children:[s.jsx("span",{className:e.statValue,children:r.length}),s.jsx("span",{className:e.statLabel,children:"Connections"})]})]})]}),s.jsxs("div",{className:e.controls,children:[s.jsxs("div",{className:e.searchWrap,children:[s.jsx(D,{size:16,className:e.searchIcon}),s.jsx("input",{className:e.search,placeholder:"Search datasets...",value:d,onChange:a=>L(a.target.value)})]}),s.jsxs("button",{className:e.exportBtn,onClick:k,disabled:l,children:[s.jsx($,{size:14}),"Refresh"]})]}),r.length>0&&s.jsxs("div",{className:e.connectionsSection,children:[s.jsx("h3",{className:e.sectionTitle,children:"Connected Sources"}),s.jsx("div",{className:e.connectionsList,children:r.map(a=>s.jsxs("div",{className:e.connectionCard,children:[s.jsx(g,{size:14,className:e.connectionIcon}),s.jsx("span",{className:e.connectionName,children:a.name}),s.jsx("span",{className:e.connectionType,children:a.type}),s.jsx("span",{className:`${e.connectionStatus} ${a.status==="active"?e.statusActive:""}`,children:a.status})]},a.id))})]}),s.jsxs("div",{className:e.table,children:[s.jsxs("div",{className:e.tableHeader,children:[s.jsx("span",{}),s.jsx("span",{children:"Dataset"}),s.jsx("span",{children:"Rows"}),s.jsx("span",{children:"Columns"}),s.jsx("span",{children:"Source"})]}),m.map(a=>s.jsxs("div",{children:[s.jsxs("div",{className:e.row,onClick:()=>I(a.id),children:[s.jsx("span",{className:e.expandIcon,children:p===a.id?s.jsx(P,{size:14}):s.jsx(A,{size:14})}),s.jsxs("div",{className:e.fileCell,children:[s.jsx(v,{size:14,className:e.fileIcon}),s.jsx("span",{className:e.fileName,children:a.name})]}),s.jsx("span",{className:e.records,children:a.row_count?.toLocaleString()||"—"}),s.jsx("span",{className:e.colCount,children:a.column_count||"—"}),s.jsx("span",{className:e.sourceType,children:s.jsx("span",{className:e.catTag,children:a.source_type||"unknown"})})]}),p===a.id&&s.jsx("div",{className:e.schemaPanel,children:y===a.id?s.jsxs("div",{className:e.schemaLoading,children:[s.jsx(f,{size:14,className:e.spin})," Loading schema..."]}):h[a.id]?s.jsxs("div",{className:e.schemaGrid,children:[s.jsxs("div",{className:e.schemaHeader,children:[s.jsx("span",{children:"Column"}),s.jsx("span",{children:"Type"})]}),h[a.id].map((n,c)=>s.jsxs("div",{className:e.schemaRow,children:[s.jsx("span",{className:e.colName,children:n.name}),s.jsx("span",{className:e.colType,children:n.type})]},c))]}):s.jsx("div",{className:e.schemaLoading,children:"No schema available"})})]},a.id)),m.length===0&&!l&&s.jsx("div",{className:e.noResults,children:"No datasets match your search."}),l&&s.jsxs("div",{className:e.noResults,children:[s.jsx(f,{size:16,className:e.spin})," Loading datasets..."]})]}),s.jsx("div",{className:e.footer,children:s.jsxs("span",{children:[m.length," of ",o.length," datasets shown"]})})]})}export{Hs as default};
