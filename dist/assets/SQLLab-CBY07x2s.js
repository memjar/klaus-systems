import{c as f,r,j as e,L as b}from"./index-yZ_RLkP0.js";import{P as N}from"./play-B7Ir4mti.js";const w=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],v=f("sparkles",w),L="_container_1a0ik_1",C="_header_1a0ik_10",E="_inputSection_1a0ik_23",Q="_textarea_1a0ik_29",H="_btn_1a0ik_46",O="_spin_1a0ik_72",T="_suggestions_1a0ik_80",$="_suggestionBtn_1a0ik_87",z="_sqlSection_1a0ik_104",G="_sqlHeader_1a0ik_111",P="_sqlCode_1a0ik_124",B="_error_1a0ik_134",M="_resultsSection_1a0ik_143",W="_resultsHeader_1a0ik_150",I="_tableWrap_1a0ik_158",J="_table_1a0ik_158",t={container:L,header:C,inputSection:E,textarea:Q,btn:H,spin:O,suggestions:T,suggestionBtn:$,sqlSection:z,sqlHeader:G,sqlCode:P,error:B,resultsSection:M,resultsHeader:W,tableWrap:I,table:J};function R({apiUrl:u}){const[l,h]=r.useState(""),[o,d]=r.useState(""),[n,i]=r.useState(null),[_,x]=r.useState(!1),[g,m]=r.useState(!1),[p,c]=r.useState(""),S={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},y=async()=>{if(l.trim()){x(!0),c(""),d(""),i(null);try{const s=await fetch(`${u}/klaus/imi/sql`,{method:"POST",headers:S,body:JSON.stringify({question:l.trim()})});if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const a=await s.json();d(a.sql||a.query||JSON.stringify(a,null,2)),a.rows&&i(a.rows),a.results&&i(a.results)}catch(s){c(s instanceof Error?s.message:"Failed to generate SQL")}finally{x(!1)}}},q=async()=>{if(o.trim()){m(!0),c(""),i(null);try{const s=await fetch(`${u}/klaus/imi/sql`,{method:"POST",headers:S,body:JSON.stringify({query:o.trim()})});if(!s.ok)throw new Error(`${s.status} ${s.statusText}`);const a=await s.json();a.sql&&d(a.sql),i(a.results||a.rows||a.data||[])}catch(s){c(s instanceof Error?s.message:"Failed to execute SQL")}finally{m(!1)}}},j=n&&n.length>0?Object.keys(n[0]):[];return e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsx("h1",{children:"SQL Lab"}),e.jsx("p",{children:"Natural language to SQL â€” query 55+ years of IMI data"})]}),e.jsxs("div",{className:t.inputSection,children:[e.jsx("textarea",{className:t.textarea,placeholder:"Ask a question in plain English, e.g. 'Show top 10 brands by awareness in Germany 2023'",value:l,onChange:s=>h(s.target.value),rows:3}),e.jsxs("button",{className:t.btn,onClick:y,disabled:_||!l.trim(),children:[_?e.jsx(b,{size:16,className:t.spin}):e.jsx(v,{size:16}),"Generate SQL"]}),e.jsx("div",{className:t.suggestions,children:["Show NPS by brand and market","Top 5 brands by awareness in Germany","Average purchase intent by quarter"].map(s=>e.jsx("button",{className:t.suggestionBtn,onClick:()=>h(s),children:s},s))})]}),o&&e.jsxs("div",{className:t.sqlSection,children:[e.jsxs("div",{className:t.sqlHeader,children:[e.jsx("span",{children:"Generated SQL"}),e.jsxs("button",{className:t.btn,onClick:q,disabled:g,children:[g?e.jsx(b,{size:16,className:t.spin}):e.jsx(N,{size:16}),"Execute"]})]}),e.jsx("pre",{className:t.sqlCode,children:o})]}),p&&e.jsx("div",{className:t.error,children:p}),n&&e.jsxs("div",{className:t.resultsSection,children:[e.jsxs("div",{className:t.resultsHeader,children:[n.length," row",n.length!==1?"s":""," returned"]}),e.jsx("div",{className:t.tableWrap,children:e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsx("tr",{children:j.map(s=>e.jsx("th",{children:s},s))})}),e.jsx("tbody",{children:n.map((s,a)=>e.jsx("tr",{children:j.map(k=>e.jsx("td",{children:String(s[k]??"")},k))},a))})]})})]})]})}export{R as default};
