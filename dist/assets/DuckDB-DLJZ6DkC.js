import{r as l,j as e,a as $,L as T,U as q,D as I,_ as U}from"./index-yZ_RLkP0.js";import{T as H}from"./trash-2-KdDYK25i.js";import{P as W}from"./play-B7Ir4mti.js";const z="_container_nv6ei_1",P="_sidebar_nv6ei_9",V="_sidebarHeader_nv6ei_19",K="_sidebarEmpty_nv6ei_32",J="_tableCard_nv6ei_42",Q="_tableName_nv6ei_56",X="_tableMeta_nv6ei_63",Z="_dropBtn_nv6ei_69",G="_uploadBtn_nv6ei_91",Y="_main_nv6ei_111",ee="_header_nv6ei_119",se="_editorSection_nv6ei_133",te="_editor_nv6ei_133",ne="_editorActions_nv6ei_157",ae="_runBtn_nv6ei_164",re="_exportBtn_nv6ei_182",oe="_editorSpacer_nv6ei_201",ce="_suggestions_nv6ei_203",ie="_suggestionBtn_nv6ei_209",le="_error_nv6ei_227",de="_resultsSection_nv6ei_238",ue="_resultsHeader_nv6ei_245",me="_resultTime_nv6ei_256",_e="_tableWrap_nv6ei_260",pe="_table_nv6ei_42",be="_truncated_nv6ei_301",he="_spin_nv6ei_309",n={container:z,sidebar:P,sidebarHeader:V,sidebarEmpty:K,tableCard:J,tableName:Q,tableMeta:X,dropBtn:Z,uploadBtn:G,main:Y,header:ee,editorSection:se,editor:te,editorActions:ne,runBtn:ae,exportBtn:re,editorSpacer:oe,suggestions:ce,suggestionBtn:ie,error:le,resultsSection:de,resultsHeader:ue,resultTime:me,tableWrap:_e,table:pe,truncated:be,spin:he};function we({apiUrl:fe}){const[S,R]=l.useState(null),[x,C]=l.useState([]),[g,f]=l.useState("SELECT 'Hello DuckDB' AS greeting, 42 AS answer;"),[o,w]=l.useState(null),[N,v]=l.useState(!1),[j,y]=l.useState(!0),[L,b]=l.useState(""),E=l.useRef(null),_=l.useRef(null),k=l.useRef(null);l.useEffect(()=>{let s=!1;async function r(){try{const t=await U(()=>import("https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/+esm"),[]),a={mvp:{mainModule:"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/dist/duckdb-mvp.wasm",mainWorker:"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/dist/duckdb-browser-mvp.worker.js"},eh:{mainModule:"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/dist/duckdb-eh.wasm",mainWorker:"https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@1.28.0/dist/duckdb-browser-eh.worker.js"}},i=await t.selectBundle(a),u=new Worker(i.mainWorker),d=new t.ConsoleLogger,c=new t.AsyncDuckDB(d,u);await c.instantiate(i.mainModule);const m=await c.connect();s||(R(c),_.current=m,y(!1))}catch(t){s||(b(`Failed to load DuckDB: ${t instanceof Error?t.message:String(t)}`),y(!1))}}return r(),()=>{s=!0}},[]);const p=async s=>{const r=(s||g).trim();if(!r||!_.current)return;v(!0),b(""),w(null);const t=performance.now();try{const a=await _.current.query(r),i=performance.now()-t,u=a.schema.fields.map(c=>c.name),d=[];for(let c=0;c<a.numRows;c++){const m={};for(const B of u){const h=a.getChild(B)?.get(c);m[B]=h!=null?typeof h=="bigint"?Number(h):h:null}d.push(m)}w({columns:u,rows:d,time:i})}catch(a){b(a instanceof Error?a.message:String(a)),w({columns:[],rows:[],time:performance.now()-t,error:String(a)})}finally{v(!1),A()}},A=async()=>{if(_.current)try{const s=await _.current.query("SELECT table_name FROM information_schema.tables WHERE table_schema='main'"),r=[];for(let a=0;a<s.numRows;a++)r.push(String(s.getChild("table_name")?.get(a)));const t=[];for(const a of r)try{const i=await _.current.query(`SELECT count(*) as c FROM "${a}"`),u=Number(i.getChild("c")?.get(0)||0),d=await _.current.query(`SELECT column_name FROM information_schema.columns WHERE table_name='${a}'`),c=[];for(let m=0;m<d.numRows;m++)c.push(String(d.getChild("column_name")?.get(m)));t.push({name:a,rows:u,columns:c})}catch{t.push({name:a,rows:0,columns:[]})}C(t)}catch{}},D=async s=>{const r=s.target.files?.[0];if(!(!r||!S)){v(!0),b("");try{const t=r.name.split(".").pop()?.toLowerCase(),a=r.name.replace(/\.[^.]+$/,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),i=await r.arrayBuffer();await S.registerFileBuffer(r.name,new Uint8Array(i)),t==="csv"?await p(`CREATE TABLE "${a}" AS SELECT * FROM read_csv_auto('${r.name}')`):t==="json"||t==="jsonl"?await p(`CREATE TABLE "${a}" AS SELECT * FROM read_json_auto('${r.name}')`):t==="parquet"?await p(`CREATE TABLE "${a}" AS SELECT * FROM read_parquet('${r.name}')`):b(`Unsupported format: .${t}. Use CSV, JSON, or Parquet.`),f(`SELECT * FROM "${a}" LIMIT 100;`)}catch(t){b(t instanceof Error?t.message:"Upload failed")}finally{v(!1),E.current&&(E.current.value="")}}},M=async s=>{await p(`DROP TABLE IF EXISTS "${s}"`),C(r=>r.filter(t=>t.name!==s))},F=()=>{if(!o||o.rows.length===0)return;const s=o.columns.join(","),r=o.rows.map(u=>o.columns.map(d=>{const c=String(u[d]??"");return c.includes(",")||c.includes('"')?`"${c.replace(/"/g,'""')}"`:c}).join(",")),t=[s,...r].join(`
`),a=new Blob([t],{type:"text/csv"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download="duckdb-results.csv",i.click()},O=s=>{(s.metaKey||s.ctrlKey)&&s.key==="Enter"&&(s.preventDefault(),p())};return e.jsxs("div",{className:n.container,children:[e.jsxs("div",{className:n.sidebar,children:[e.jsxs("div",{className:n.sidebarHeader,children:[e.jsx($,{size:16}),e.jsx("span",{children:"Tables"})]}),j?e.jsxs("div",{className:n.sidebarEmpty,children:[e.jsx(T,{size:16,className:n.spin})," Loading DuckDB..."]}):x.length===0?e.jsx("div",{className:n.sidebarEmpty,children:"No tables yet. Upload a file or CREATE TABLE."}):x.map(s=>e.jsxs("div",{className:n.tableCard,onClick:()=>{f(`SELECT * FROM "${s.name}" LIMIT 100;`),p(`SELECT * FROM "${s.name}" LIMIT 100;`)},children:[e.jsx("div",{className:n.tableName,children:s.name}),e.jsxs("div",{className:n.tableMeta,children:[s.rows.toLocaleString()," rows · ",s.columns.length," cols"]}),e.jsx("button",{className:n.dropBtn,onClick:r=>{r.stopPropagation(),M(s.name)},title:"Drop table",children:e.jsx(H,{size:12})})]},s.name)),e.jsx("input",{ref:E,type:"file",accept:".csv,.json,.jsonl,.parquet",onChange:D,style:{display:"none"}}),e.jsxs("button",{className:n.uploadBtn,onClick:()=>E.current?.click(),disabled:j,children:[e.jsx(q,{size:14})," Import File"]})]}),e.jsxs("div",{className:n.main,children:[e.jsxs("div",{className:n.header,children:[e.jsx("h1",{children:"DuckDB"}),e.jsx("p",{children:"In-browser analytical SQL — no server required. Import CSV, JSON, or Parquet files."})]}),e.jsxs("div",{className:n.editorSection,children:[e.jsx("textarea",{ref:k,className:n.editor,value:g,onChange:s=>f(s.target.value),onKeyDown:O,placeholder:"Enter SQL query...",rows:5,spellCheck:!1}),e.jsxs("div",{className:n.editorActions,children:[e.jsxs("button",{className:n.runBtn,onClick:()=>p(),disabled:N||j||!g.trim(),children:[N?e.jsx(T,{size:14,className:n.spin}):e.jsx(W,{size:14}),"Run ",navigator.platform.includes("Mac")?"⌘":"Ctrl","+Enter"]}),o&&o.rows.length>0&&e.jsxs("button",{className:n.exportBtn,onClick:F,children:[e.jsx(I,{size:14})," Export CSV"]}),e.jsx("div",{className:n.editorSpacer}),e.jsx("div",{className:n.suggestions,children:["SELECT * FROM ","DESCRIBE ","SHOW TABLES","CREATE TABLE demo AS SELECT * FROM read_csv_auto('file.csv')"].map(s=>e.jsx("button",{className:n.suggestionBtn,onClick:()=>f(s),children:s},s))})]})]}),L&&e.jsx("div",{className:n.error,children:L}),o&&!o.error&&e.jsxs("div",{className:n.resultsSection,children:[e.jsxs("div",{className:n.resultsHeader,children:[e.jsxs("span",{children:[o.rows.length," row",o.rows.length!==1?"s":""]}),e.jsxs("span",{className:n.resultTime,children:[o.time.toFixed(1),"ms"]})]}),e.jsx("div",{className:n.tableWrap,children:e.jsxs("table",{className:n.table,children:[e.jsx("thead",{children:e.jsx("tr",{children:o.columns.map(s=>e.jsx("th",{children:s},s))})}),e.jsx("tbody",{children:o.rows.slice(0,500).map((s,r)=>e.jsx("tr",{children:o.columns.map(t=>e.jsx("td",{children:String(s[t]??"NULL")},t))},r))})]})}),o.rows.length>500&&e.jsxs("div",{className:n.truncated,children:["Showing 500 of ",o.rows.length," rows"]})]})]})]})}export{we as default};
