import{c as g,r as n,j as e,G as E,X as G,L as q}from"./index-yZ_RLkP0.js";import{P as H}from"./plus-BFfVhgJW.js";const K=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],Q=g("arrow-down-right",K);const B=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],V=g("arrow-up-right",B);const W=[["path",{d:"M5 12h14",key:"1ays0h"}]],D=g("minus",W),Y="_container_2otwh_1",Z="_header_2otwh_10",ee="_section_2otwh_26",se="_label_2otwh_32",te="_pills_2otwh_41",ne="_pill_2otwh_41",oe="_pillX_2otwh_60",ae="_dropdown_2otwh_78",re="_searchRow_2otwh_82",ce="_searchIcon_2otwh_92",ie="_searchInput_2otwh_97",le="_dropdownList_2otwh_116",de="_dropdownItem_2otwh_129",he="_sampleSize_2otwh_154",pe="_input_2otwh_160",ue="_actions_2otwh_181",me="_btn_2otwh_187",_e="_btnSecondary_2otwh_212",we="_spin_2otwh_232",fe="_legend_2otwh_241",xe="_legendItem_2otwh_249",je="_trendUp_2otwh_255",ge="_trendDown_2otwh_259",ye="_error_2otwh_264",Ne="_resultSection_2otwh_274",Se="_resultText_2otwh_281",t={container:Y,header:Z,section:ee,label:se,pills:te,pill:ne,pillX:oe,dropdown:ae,searchRow:re,searchIcon:ce,searchInput:ie,dropdownList:le,dropdownItem:de,sampleSize:he,input:pe,actions:ue,btn:me,btnSecondary:_e,spin:we,legend:fe,legendItem:xe,trendUp:je,trendDown:ge,error:ye,resultSection:Ne,resultText:Se};function Ce({apiUrl:u}){const[T,$]=n.useState([]),[o,m]=n.useState([]),[y,_]=n.useState(""),[i,N]=n.useState(""),[w,S]=n.useState(!1),[v,M]=n.useState(!0),[f,l]=n.useState(""),[b,d]=n.useState(""),[O,h]=n.useState(!1),x=n.useRef(null),C={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"};n.useEffect(()=>{fetch(`${u}/klaus/imi/surveys`,{headers:C}).then(s=>s.json()).then(s=>$(s.surveys||[])).catch(()=>d("Failed to load surveys")).finally(()=>M(!1))},[u]),n.useEffect(()=>{const s=r=>{x.current&&!x.current.contains(r.target)&&h(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const X=s=>{o.length>=4||o.find(r=>r.id===s.id)||(m([...o,s]),_(""),h(!1))},P=s=>{m(o.filter(r=>r.id!==s))},k=T.filter(s=>!o.find(r=>r.id===s.id)&&s.name.toLowerCase().includes(y.toLowerCase())),I=async()=>{if(o.length<2||!i.trim())return;S(!0),d(""),l("");const s=o.map(a=>a.name).join(", "),r=`Compare the following studies on ${i.trim()}: ${s}. Show a detailed comparison table with key differences and trends.`;try{const a=await fetch(`${u}/klaus/imi/chat`,{method:"POST",headers:C,body:JSON.stringify({message:r,history:[]})});if(!a.ok)throw new Error(`${a.status} ${a.statusText}`);if(!a.body)throw new Error("No response body");const U=a.body.getReader(),A=new TextDecoder;let c="";for(;;){const{done:p,value:j}=await U.read();if(p)break;c+=A.decode(j,{stream:!0});const L=c.split(`
`);c=L.pop()||"";for(const z of L)if(z.trim())try{const R=JSON.parse(z);R.content&&l(F=>F+R.content)}catch{}}if(c.trim())try{const p=JSON.parse(c);p.content&&l(j=>j+p.content)}catch{}}catch(a){d(a instanceof Error?a.message:"Request failed")}finally{S(!1)}},J=()=>{m([]),N(""),l(""),d(""),_("")};return e.jsxs("div",{className:t.container,children:[e.jsxs("div",{className:t.header,children:[e.jsxs("h1",{children:[e.jsx(E,{size:20})," Cross-Study Comparison"]}),e.jsx("p",{children:"Select 2â€“4 datasets and compare metrics across studies"})]}),e.jsxs("div",{className:t.section,children:[e.jsxs("label",{className:t.label,children:["Datasets (",o.length,"/4)"]}),e.jsx("div",{className:t.pills,children:o.map(s=>e.jsxs("span",{className:t.pill,children:[s.name,e.jsx("button",{className:t.pillX,onClick:()=>P(s.id),children:e.jsx(G,{size:12})})]},s.id))}),o.length<4&&e.jsxs("div",{className:t.dropdown,ref:x,children:[e.jsxs("div",{className:t.searchRow,children:[e.jsx(H,{size:14,className:t.searchIcon}),e.jsx("input",{className:t.searchInput,placeholder:v?"Loading surveys...":"Search and add a dataset...",value:y,onChange:s=>{_(s.target.value),h(!0)},onFocus:()=>h(!0),disabled:v})]}),O&&k.length>0&&e.jsx("div",{className:t.dropdownList,children:k.map(s=>e.jsxs("button",{className:t.dropdownItem,onClick:()=>X(s),children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:t.sampleSize,children:["n=",s.total_n?.toLocaleString()]})]},s.id))})]})]}),e.jsxs("div",{className:t.section,children:[e.jsx("label",{className:t.label,children:"Comparison Metric / Query"}),e.jsx("input",{className:t.input,placeholder:"e.g. NPS scores, brand awareness, customer satisfaction...",value:i,onChange:s=>N(s.target.value),onKeyDown:s=>{s.key==="Enter"&&I()}})]}),e.jsxs("div",{className:t.actions,children:[e.jsxs("button",{className:t.btn,onClick:I,disabled:w||o.length<2||!i.trim(),children:[w?e.jsx(q,{size:16,className:t.spin}):e.jsx(E,{size:16}),w?"Comparing...":"Compare"]}),e.jsxs("button",{className:t.btnSecondary,onClick:J,children:[e.jsx(D,{size:14})," Clear"]})]}),f&&e.jsxs("div",{className:t.legend,children:[e.jsxs("span",{className:t.legendItem,children:[e.jsx(V,{size:13,className:t.trendUp})," Increase"]}),e.jsxs("span",{className:t.legendItem,children:[e.jsx(Q,{size:13,className:t.trendDown})," Decrease"]}),e.jsxs("span",{className:t.legendItem,children:[e.jsx(D,{size:13})," No change"]})]}),b&&e.jsx("div",{className:t.error,children:b}),f&&e.jsx("div",{className:t.resultSection,children:e.jsx("div",{className:t.resultText,children:f})})]})}export{Ce as default};
