import{c as $,r as i,j as e,L as v,U as B,F as I,H as A,D as j}from"./index-yZ_RLkP0.js";import{S as D}from"./search-BJeNHSDh.js";import{R as E}from"./refresh-cw-CLIdgFi0.js";const H=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],T=$("cloud",H),F="_container_kkybu_1",O="_header_kkybu_7",U="_controls_kkybu_23",W="_searchWrap_kkybu_31",M="_searchIcon_kkybu_36",K="_search_kkybu_31",P="_categories_kkybu_60",Z="_catBtn_kkybu_66",q="_catActive_kkybu_82",G="_table_kkybu_89",J="_tableHeader_kkybu_96",Q="_row_kkybu_108",V="_fileCell_kkybu_121",X="_fileIcon_kkybu_127",Y="_fileName_kkybu_132",ee="_category_kkybu_141",se="_catTag_kkybu_145",ae="_records_kkybu_154",te="_noResults_kkybu_167",ne="_footer_kkybu_175",re="_exportBtn_kkybu_184",ce="_spin_kkybu_203",t={container:F,header:O,controls:U,searchWrap:W,searchIcon:M,search:K,categories:P,catBtn:Z,catActive:q,table:G,tableHeader:J,row:Q,fileCell:V,fileIcon:X,fileName:Y,category:ee,catTag:se,records:ae,noResults:te,footer:ne,exportBtn:re,spin:ce};function _(l){const a=l.toLowerCase();return a.includes("brand_health")||a.includes("brand_trust")?"Brand Health":a.includes("competitive")||a.includes("benchmark")?"Competitive":a.includes("sentiment")||a.includes("buy_canadian")||a.includes("buy_local")?"Sentiment":a.includes("genz")||a.includes("gen_z")||a.includes("lifestyle")?"Segmentation":a.includes("promotion")||a.includes("roi")||a.includes("sponsorship")?"ROI":a.includes("say_do")||a.includes("purchase_driver")?"Behavioral":a.includes("ad_pretest")||a.includes("campaign")?"Advertising":a.includes("sport")||a.includes("fandom")||a.includes("viewership")?"Sports":a.includes("tariff")||a.includes("made_in_canada")?"Trade":a.includes("marketing")||a.includes("effectiveness")?"Marketing":"Other"}function de({apiUrl:l}){const[a,w]=i.useState([]),[h,N]=i.useState(""),[m,C]=i.useState("All"),[d,x]=i.useState(!0),[y,b]=i.useState(!1),u=i.useRef(null),p=async()=>{x(!0);const s=[];try{const n=await fetch(`${l}/klaus/imi/surveys`,{headers:{"ngrok-skip-browser-warning":"true"}});if(n.ok){const r=await n.json();for(const c of r.surveys||[])s.push({id:c.id,name:c.name||c.id,total_n:c.total_n||0,source:"backend"})}}catch{}try{const n=await fetch(`${l}/klaus/imi/drive/files`,{headers:{"ngrok-skip-browser-warning":"true"}});if(n.ok){const r=await n.json(),c=new Set(s.map(o=>o.name.toLowerCase().replace(/ /g,"_")));for(const o of r.files||[]){const g=o.name.replace(/\.\w+$/,"").toLowerCase();if(!c.has(g))s.push({id:o.id,name:o.name,total_n:0,source:"drive",drive_id:o.id,web_link:o.web_link,modified:o.modified,size:o.size});else{const k=s.find(R=>R.name.toLowerCase().replace(/ /g,"_")===g);k&&(k.drive_id=o.id,k.web_link=o.web_link)}}}}catch{}w(s),x(!1)};i.useEffect(()=>{p()},[]);const S=async s=>{const n=s.target.files?.[0];if(!n)return;b(!0);const r=new FormData;r.append("file",n);try{(await fetch(`${l}/klaus/imi/upload-survey`,{method:"POST",headers:{"ngrok-skip-browser-warning":"true"},body:r})).ok&&await p()}catch{}b(!1),u.current&&(u.current.value="")},z=["All",...Array.from(new Set(a.map(s=>_(s.name))))],f=a.filter(s=>{const n=!h||s.name.toLowerCase().includes(h.toLowerCase()),r=m==="All"||_(s.name)===m;return n&&r}),L=a.reduce((s,n)=>s+n.total_n,0);return e.jsxs("div",{className:t.container,children:[e.jsx("div",{className:t.header,children:e.jsxs("div",{children:[e.jsx("h1",{children:"Data Explorer"}),e.jsx("p",{children:d?"Loading...":`${a.length} IMI research datasets — ${L.toLocaleString()} total records`})]})}),e.jsxs("div",{className:t.controls,children:[e.jsxs("div",{className:t.searchWrap,children:[e.jsx(D,{size:16,className:t.searchIcon}),e.jsx("input",{className:t.search,placeholder:"Search datasets...",value:h,onChange:s=>N(s.target.value)})]}),e.jsx("div",{className:t.categories,children:z.map(s=>e.jsx("button",{className:`${t.catBtn} ${m===s?t.catActive:""}`,onClick:()=>C(s),children:s},s))}),e.jsx("input",{ref:u,type:"file",accept:".xlsx,.xls,.csv,.json",onChange:S,style:{display:"none"}}),e.jsxs("button",{className:t.exportBtn,onClick:()=>u.current?.click(),disabled:y,children:[y?e.jsx(v,{size:14,className:t.spin}):e.jsx(B,{size:14}),"Upload Survey"]}),e.jsxs("button",{className:t.exportBtn,onClick:p,disabled:d,children:[e.jsx(E,{size:14}),"Refresh"]})]}),e.jsxs("div",{className:t.table,children:[e.jsxs("div",{className:t.tableHeader,children:[e.jsx("span",{children:"Dataset"}),e.jsx("span",{children:"Category"}),e.jsx("span",{children:"Records"}),e.jsx("span",{children:"Source"})]}),f.map(s=>e.jsxs("div",{className:t.row,children:[e.jsxs("div",{className:t.fileCell,children:[e.jsx(I,{size:14,className:t.fileIcon}),e.jsx("span",{className:t.fileName,children:s.name})]}),e.jsx("span",{className:t.category,children:e.jsx("span",{className:t.catTag,children:_(s.name)})}),e.jsx("span",{className:t.records,children:s.total_n||"—"}),e.jsxs("div",{className:t.fileCell,children:[s.drive_id?e.jsx(T,{size:12,style:{color:"var(--green)",opacity:.7}}):e.jsx(A,{size:12,style:{color:"var(--text-muted)"}}),e.jsx("span",{style:{fontSize:11,color:"var(--text-muted)"},children:s.drive_id?"Drive":"Local"}),s.web_link&&e.jsx("a",{href:s.web_link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:11,color:"var(--green)"},children:"Open"}),s.drive_id&&e.jsx("a",{href:`${l}/klaus/imi/drive/download/${s.drive_id}`,style:{fontSize:11,color:"var(--text-secondary)"},children:e.jsx(j,{size:11})})]})]},s.id)),f.length===0&&!d&&e.jsx("div",{className:t.noResults,children:"No datasets match your search."}),d&&e.jsxs("div",{className:t.noResults,children:[e.jsx(v,{size:16,className:t.spin})," Loading datasets..."]})]}),e.jsxs("div",{className:t.footer,children:[e.jsxs("span",{children:[f.length," of ",a.length," datasets shown"]}),e.jsxs("button",{className:t.exportBtn,onClick:()=>{const s=["name,category,records,source"];a.forEach(c=>s.push(`${c.name},${_(c.name)},${c.total_n},${c.source}`));const n=new Blob([s.join(`
`)],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="imi_datasets_catalog.csv",r.click()},children:[e.jsx(j,{size:14}),"Export Catalog"]})]})]})}export{de as default};
