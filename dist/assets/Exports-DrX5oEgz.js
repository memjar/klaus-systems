import{c as H,r,j as e,F as P,P as B,D as _,L as G}from"./index-yZ_RLkP0.js";const I=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],M=H("table",I),U="_container_rkuke_1",z="_header_rkuke_10",J="_section_rkuke_23",Q="_label_rkuke_29",K="_formatGrid_rkuke_37",V="_formatCard_rkuke_43",X="_formatCardActive_rkuke_64",Y="_formatLabel_rkuke_76",q="_formatDesc_rkuke_81",W="_select_rkuke_87",Z="_input_rkuke_102",ee="_btn_rkuke_117",te="_spin_rkuke_143",se="_error_rkuke_151",ae="_downloadSection_rkuke_160",oe="_downloadLink_rkuke_167",re="_historySection_rkuke_182",ne="_historyHeader_rkuke_188",ie="_clearBtn_rkuke_195",ce="_historyList_rkuke_212",le="_historyItem_rkuke_218",de="_historyFormat_rkuke_231",me="_historyTemplate_rkuke_236",pe="_historyTopic_rkuke_240",he="_historyTime_rkuke_247",s={container:U,header:z,section:J,label:Q,formatGrid:K,formatCard:V,formatCardActive:X,formatLabel:Y,formatDesc:q,select:W,input:Z,btn:ee,spin:te,error:se,downloadSection:ae,downloadLink:oe,historySection:re,historyHeader:ne,clearBtn:ie,historyList:ce,historyItem:le,historyFormat:de,historyTemplate:me,historyTopic:pe,historyTime:he},ue=[{format:"pdf",label:"PDF",icon:P,desc:"Formatted report document"},{format:"pptx",label:"PPTX",icon:B,desc:"Presentation deck"},{format:"csv",label:"CSV",icon:M,desc:"Raw data export"},{format:"markdown",label:"Markdown",icon:_,desc:"Plain text report"}],L=["Brand Health Summary","Market Landscape","Competitive Analysis","Trend Report","Executive Brief"],C="klaus-export-history";function _e(){try{return JSON.parse(localStorage.getItem(C)||"[]")}catch{return[]}}function v(c){localStorage.setItem(C,JSON.stringify(c.slice(0,20)))}function xe({apiUrl:c}){const[a,D]=r.useState("pdf"),[n,k]=r.useState(L[0]),[E,$]=r.useState(L),[l,R]=r.useState(""),[y,x]=r.useState(!1),[f,b]=r.useState(""),[w,d]=r.useState(""),[j,m]=r.useState(""),[p,N]=r.useState(_e),F={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"};r.useEffect(()=>{fetch(`${c}/klaus/imi/reports/templates`,{headers:{"ngrok-skip-browser-warning":"true"}}).then(t=>t.ok?t.json():null).then(t=>{t?.templates&&Array.isArray(t.templates)&&($(t.templates),k(t.templates[0]))}).catch(()=>{})},[c]);const A=async()=>{x(!0),b(""),d(""),m("");try{const t=a==="pptx"?`${c}/klaus/imi/report/pptx`:`${c}/klaus/imi/report/generate`,h=a==="pptx"?{template:n,...l?{topic:l}:{}}:{template:n,format:a,...l?{topic:l}:{}},i=await fetch(t,{method:"POST",headers:F,body:JSON.stringify(h)});if(!i.ok)throw new Error(`${i.status} ${i.statusText}`);if((i.headers.get("content-type")||"").includes("application/json")){const o=await i.json(),T=o.result||o.report||o.content||o.download_url||JSON.stringify(o,null,2);if(o.download_url)d(o.download_url),m(o.filename||`report.${a}`);else if(a==="markdown"){const u=new Blob([T],{type:"text/markdown"});d(URL.createObjectURL(u)),m(`${n.toLowerCase().replace(/\s+/g,"-")}.md`)}else{const u=new Blob([T],{type:"text/plain"});d(URL.createObjectURL(u)),m(`${n.toLowerCase().replace(/\s+/g,"-")}.${a}`)}}else{const o=await i.blob();d(URL.createObjectURL(o)),m(`${n.toLowerCase().replace(/\s+/g,"-")}.${a}`)}const g=[{id:Date.now().toString(),template:n,format:a,topic:l||"â€”",timestamp:new Date().toISOString(),filename:`${n.toLowerCase().replace(/\s+/g,"-")}.${a}`},...p].slice(0,20);N(g),v(g)}catch(t){b(t instanceof Error?t.message:"Export failed")}finally{x(!1)}},O=()=>{N([]),v([])};return e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h1",{children:"Export Center"}),e.jsx("p",{children:"Generate and download reports in multiple formats"})]}),e.jsxs("div",{className:s.section,children:[e.jsx("label",{className:s.label,children:"Format"}),e.jsx("div",{className:s.formatGrid,children:ue.map(({format:t,label:h,icon:i,desc:S})=>e.jsxs("button",{className:`${s.formatCard} ${a===t?s.formatCardActive:""}`,onClick:()=>D(t),children:[e.jsx(i,{size:20}),e.jsx("span",{className:s.formatLabel,children:h}),e.jsx("span",{className:s.formatDesc,children:S})]},t))})]}),e.jsxs("div",{className:s.section,children:[e.jsx("label",{className:s.label,children:"Template"}),e.jsx("select",{className:s.select,value:n,onChange:t=>k(t.target.value),children:E.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:s.section,children:[e.jsx("label",{className:s.label,children:"Topic / Query (optional)"}),e.jsx("input",{className:s.input,placeholder:"e.g. brand awareness in Germany, Q4 performance...",value:l,onChange:t=>R(t.target.value)})]}),e.jsxs("button",{className:s.btn,onClick:A,disabled:y,children:[y?e.jsx(G,{size:16,className:s.spin}):e.jsx(_,{size:16}),"Generate ",a.toUpperCase()]}),f&&e.jsx("div",{className:s.error,children:f}),w&&e.jsx("div",{className:s.downloadSection,children:e.jsxs("a",{href:w,download:j,className:s.downloadLink,children:[e.jsx(_,{size:16}),"Download ",j]})}),p.length>0&&e.jsxs("div",{className:s.historySection,children:[e.jsxs("div",{className:s.historyHeader,children:[e.jsx("label",{className:s.label,children:"Recent Exports"}),e.jsx("button",{className:s.clearBtn,onClick:O,children:"Clear"})]}),e.jsx("div",{className:s.historyList,children:p.map(t=>e.jsxs("div",{className:s.historyItem,children:[e.jsx("span",{className:s.historyFormat,children:t.format.toUpperCase()}),e.jsx("span",{className:s.historyTemplate,children:t.template}),e.jsx("span",{className:s.historyTopic,children:t.topic}),e.jsxs("span",{className:s.historyTime,children:[new Date(t.timestamp).toLocaleDateString()," ",new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]},t.id))})]})]})}export{xe as default};
