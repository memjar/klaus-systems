import{c as _,r as l,j as e,S as h,L as R}from"./index-yZ_RLkP0.js";import{S as I}from"./search-BJeNHSDh.js";import{A as W}from"./activity-wPAWYXsf.js";const z=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],f=_("clock",z);const G=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],U=_("funnel",G);const V=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],H=_("user",V),$="_container_11y4h_1",M="_header_11y4h_10",B="_statsGrid_11y4h_27",F="_statCard_11y4h_33",q="_statLabel_11y4h_40",Q="_statValue_11y4h_49",O="_filterBar_11y4h_57",P="_searchWrap_11y4h_64",J="_searchIcon_11y4h_70",K="_searchInput_11y4h_78",X="_filterGroup_11y4h_94",Y="_select_11y4h_101",Z="_tableWrap_11y4h_117",ee="_tableHeader_11y4h_124",se="_tableRow_11y4h_137",ae="_rowExpanded_11y4h_153",te="_cellTimestamp_11y4h_166",le="_cellUser_11y4h_172",ce="_cellAction_11y4h_176",ne="_cellCategory_11y4h_180",re="_cellDetails_11y4h_183",ie="_tag_11y4h_188",oe="_expandedRow_11y4h_200",de="_expandedLabel_11y4h_206",he="_expandedContent_11y4h_215",_e="_loadingWrap_11y4h_224",pe="_spin_11y4h_230",xe="_emptyState_11y4h_239",me="_placeholder_11y4h_246",s={container:$,header:M,statsGrid:B,statCard:F,statLabel:q,statValue:Q,filterBar:O,searchWrap:P,searchIcon:J,searchInput:K,filterGroup:X,select:Y,tableWrap:Z,tableHeader:ee,tableRow:se,rowExpanded:ae,cellTimestamp:te,cellUser:le,cellAction:ce,cellCategory:ne,cellDetails:re,tag:ie,expandedRow:oe,expandedLabel:de,expandedContent:he,loadingWrap:_e,spin:pe,emptyState:xe,placeholder:me},ue=["All","Query","Export","Upload","Login"],ye=["Today","7 days","30 days","All"];function ge({apiUrl:p}){const[g,N]=l.useState([]),[c,L]=l.useState(null),[C,x]=l.useState(!0),[w,m]=l.useState(!1),[r,b]=l.useState(""),[i,S]=l.useState("All"),[n,A]=l.useState("All"),[o,k]=l.useState(null),u={"ngrok-skip-browser-warning":"true"},D=async()=>{x(!0),m(!1);try{const[a,t]=await Promise.all([fetch(`${p}/klaus/imi/audit/logs`,{headers:u}),fetch(`${p}/klaus/imi/audit/stats`,{headers:u})]);if(!a.ok||!t.ok)throw new Error("Failed");const j=await a.json(),v=await t.json();N(j.logs||[]),L(v)}catch{m(!0)}finally{x(!1)}};l.useEffect(()=>{D()},[]);const y=g.filter(a=>{if(i!=="All"&&a.category.toLowerCase()!==i.toLowerCase())return!1;if(r){const t=r.toLowerCase();if(!a.user.toLowerCase().includes(t)&&!a.action.toLowerCase().includes(t)&&!a.details.toLowerCase().includes(t))return!1}if(n!=="All"){const t=new Date(a.timestamp),d=(new Date().getTime()-t.getTime())/(1e3*60*60*24);if(n==="Today"&&d>1||n==="7 days"&&d>7||n==="30 days"&&d>30)return!1}return!0}),E=a=>{try{return new Date(a).toLocaleString()}catch{return a}},T=(a,t=80)=>a.length>t?a.slice(0,t)+"...":a;return w?e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("h1",{children:[e.jsx(h,{size:20})," Audit Log"]}),e.jsx("p",{children:"Compliance event tracking and activity monitoring"})]}),e.jsxs("div",{className:s.placeholder,children:[e.jsx(h,{size:48}),e.jsx("p",{children:"Audit logging will be available once configured by your admin"})]})]}):e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("h1",{children:[e.jsx(h,{size:20})," Audit Log"]}),e.jsx("p",{children:"Compliance event tracking and activity monitoring"})]}),C?e.jsx("div",{className:s.loadingWrap,children:e.jsx(R,{size:24,className:s.spin})}):e.jsxs(e.Fragment,{children:[c&&e.jsxs("div",{className:s.statsGrid,children:[e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statLabel,children:"Total Queries"}),e.jsx("div",{className:s.statValue,children:c.total_queries.toLocaleString()})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statLabel,children:"Total Exports"}),e.jsx("div",{className:s.statValue,children:c.total_exports.toLocaleString()})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statLabel,children:"Active Users"}),e.jsx("div",{className:s.statValue,children:c.active_users.toLocaleString()})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statLabel,children:"Last 24h"}),e.jsx("div",{className:s.statValue,children:c.last_24h.toLocaleString()})]})]}),e.jsxs("div",{className:s.filterBar,children:[e.jsxs("div",{className:s.searchWrap,children:[e.jsx(I,{size:14,className:s.searchIcon}),e.jsx("input",{className:s.searchInput,placeholder:"Search logs...",value:r,onChange:a=>b(a.target.value)})]}),e.jsxs("div",{className:s.filterGroup,children:[e.jsx(U,{size:14}),e.jsx("select",{className:s.select,value:i,onChange:a=>S(a.target.value),children:ue.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:s.filterGroup,children:[e.jsx(f,{size:14}),e.jsx("select",{className:s.select,value:n,onChange:a=>A(a.target.value),children:ye.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),y.length===0?e.jsx("div",{className:s.emptyState,children:"No log entries match your filters"}):e.jsxs("div",{className:s.tableWrap,children:[e.jsxs("div",{className:s.tableHeader,children:[e.jsx("span",{children:"Timestamp"}),e.jsx("span",{children:"User"}),e.jsx("span",{children:"Action"}),e.jsx("span",{children:"Category"}),e.jsx("span",{children:"Details"})]}),y.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:`${s.tableRow} ${o===a.id?s.rowExpanded:""}`,onClick:()=>k(o===a.id?null:a.id),children:[e.jsxs("span",{className:s.cellTimestamp,children:[e.jsx(f,{size:12})," ",E(a.timestamp)]}),e.jsxs("span",{className:s.cellUser,children:[e.jsx(H,{size:12})," ",a.user]}),e.jsxs("span",{className:s.cellAction,children:[e.jsx(W,{size:12})," ",a.action]}),e.jsx("span",{className:s.cellCategory,children:e.jsx("span",{className:s.tag,children:a.category})}),e.jsx("span",{className:s.cellDetails,children:T(a.details)})]}),o===a.id&&e.jsxs("div",{className:s.expandedRow,children:[e.jsx("div",{className:s.expandedLabel,children:"Full Details"}),e.jsx("div",{className:s.expandedContent,children:a.details})]})]},a.id))]})]})]})}export{ge as default};
