import{c as B,r as o,j as s,L as D}from"./index-yZ_RLkP0.js";import{S as H}from"./search-BJeNHSDh.js";import{R as W}from"./refresh-cw-CLIdgFi0.js";const G=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],k=B("network",G),I="_container_1v648_1",M="_header_1v648_7",q="_stats_1v648_26",K="_stat_1v648_26",O="_controls_1v648_44",P="_searchWrap_1v648_52",V="_searchIcon_1v648_57",Y="_search_1v648_52",F="_btn_1v648_81",J="_filters_1v648_101",Q="_filterBtn_1v648_108",X="_filterActive_1v648_124",Z="_center_1v648_131",U="_placeholder_1v648_141",ee="_spin_1v648_148",se="_nodeList_1v648_157",ne="_nodeCard_1v648_163",te="_nodeHeader_1v648_176",ce="_nodeLabel_1v648_182",oe="_nodeType_1v648_188",ae="_connCount_1v648_198",re="_connections_1v648_206",le="_connection_1v648_206",ie="_relLabel_1v648_222",de="_connNode_1v648_229",he="_connDot_1v648_236",pe="_noConn_1v648_243",n={container:I,header:M,stats:q,stat:K,controls:O,searchWrap:P,searchIcon:V,search:Y,btn:F,filters:J,filterBtn:Q,filterActive:X,center:Z,placeholder:U,spin:ee,nodeList:se,nodeCard:ne,nodeHeader:te,nodeLabel:ce,nodeType:oe,connCount:ae,connections:re,connection:le,relLabel:ie,connNode:de,connDot:he,noConn:pe},_e={Brand:"var(--green)",Segment:"#60a5fa",Concept:"#f59e0b",Study:"#a78bfa",Metric:"#f472b6"};function m(r){return _e[r]||"var(--text-muted)"}function ve({apiUrl:r}){const[h,l]=o.useState([]),[f,v]=o.useState([]),[j,w]=o.useState(""),[N,u]=o.useState(!0),[L,S]=o.useState(null),[p,C]=o.useState(null),[b,i]=o.useState(!1),x={"ngrok-skip-browser-warning":"true"},_=o.useCallback(async()=>{u(!0),i(!1);try{const[e,t]=await Promise.all([fetch(`${r}/klaus/imi/graph/nodes`,{headers:x}),fetch(`${r}/klaus/imi/graph/edges`,{headers:x})]);if(!e.ok||!t.ok){i(!0),l([]),v([]);return}const c=await e.json(),d=await t.json(),a=c.nodes||[],g=d.edges||[];l(a),v(g),a.length===0&&i(!0)}catch{i(!0),l([]),v([])}finally{u(!1)}},[r]),E=o.useCallback(async e=>{if(!e.trim()){_();return}u(!0);try{const t=await fetch(`${r}/klaus/imi/graph/search?q=${encodeURIComponent(e)}`,{headers:x});if(!t.ok){i(!0),l([]);return}const c=await t.json();l(c.nodes||[])}catch{i(!0),l([])}finally{u(!1)}},[r,_]);o.useEffect(()=>{_()},[_]);const T=e=>{e.preventDefault(),E(j)},A=e=>f.filter(t=>t.source===e||t.target===e).length,R=e=>f.filter(t=>t.source===e||t.target===e).map(t=>{const c=t.source===e?t.target:t.source;return{node:h.find(a=>a.id===c),relationship:t.relationship,direction:t.source===e?"out":"in"}}).filter(t=>t.node),y=Array.from(new Set(h.map(e=>e.type))).sort(),$=h.filter(e=>!(p&&e.type!==p)),z=y.map(e=>({type:e,count:h.filter(t=>t.type===e).length}));return s.jsxs("div",{className:n.container,children:[s.jsxs("div",{className:n.header,children:[s.jsxs("h1",{children:[s.jsx(k,{size:20})," Knowledge Graph"]}),s.jsx("p",{children:"Explore entity relationships across datasets"})]}),!N&&!b&&s.jsxs("div",{className:n.stats,children:[s.jsxs("span",{className:n.stat,children:[h.length," nodes"]}),s.jsxs("span",{className:n.stat,children:[f.length," edges"]}),z.map(e=>s.jsxs("span",{className:n.stat,style:{borderColor:m(e.type)},children:[e.type,": ",e.count]},e.type))]}),s.jsxs("div",{className:n.controls,children:[s.jsxs("form",{onSubmit:T,className:n.searchWrap,children:[s.jsx(H,{size:14,className:n.searchIcon}),s.jsx("input",{className:n.search,placeholder:"Search nodes...",value:j,onChange:e=>w(e.target.value)})]}),s.jsx("button",{className:n.btn,onClick:_,title:"Refresh",children:s.jsx(W,{size:14})})]}),y.length>0&&s.jsxs("div",{className:n.filters,children:[s.jsx("button",{className:`${n.filterBtn} ${p?"":n.filterActive}`,onClick:()=>C(null),children:"All"}),y.map(e=>s.jsx("button",{className:`${n.filterBtn} ${p===e?n.filterActive:""}`,style:{"--type-color":m(e)},onClick:()=>C(p===e?null:e),children:e},e))]}),N?s.jsxs("div",{className:n.center,children:[s.jsx(D,{size:24,className:n.spin}),s.jsx("p",{children:"Loading graph..."})]}):b?s.jsxs("div",{className:n.center,children:[s.jsx(k,{size:40,style:{opacity:.3}}),s.jsx("p",{className:n.placeholder,children:"Knowledge graph will populate as you query datasets"})]}):s.jsx("div",{className:n.nodeList,children:$.map(e=>{const t=A(e.id),c=L===e.id,d=c?R(e.id):[];return s.jsxs("div",{className:n.nodeCard,onClick:()=>S(c?null:e.id),children:[s.jsxs("div",{className:n.nodeHeader,children:[s.jsx("span",{className:n.nodeLabel,children:e.label}),s.jsx("span",{className:n.nodeType,style:{background:m(e.type)},children:e.type}),s.jsxs("span",{className:n.connCount,children:[t," connection",t!==1?"s":""]})]}),c&&d.length>0&&s.jsx("div",{className:n.connections,children:d.map((a,g)=>s.jsxs("div",{className:n.connection,children:[s.jsxs("span",{className:n.relLabel,children:[a.direction==="out"?"→":"←"," ",a.relationship]}),s.jsxs("span",{className:n.connNode,children:[s.jsx("span",{className:n.connDot,style:{background:m(a.node.type)}}),a.node.label]})]},g))}),c&&d.length===0&&s.jsx("div",{className:n.connections,children:s.jsx("span",{className:n.noConn,children:"No connections"})})]},e.id)})})]})}export{ve as default};
